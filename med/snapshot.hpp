/**
@file
snapshot of buffer state for inplace updating

@copyright Denis Priyomov 2016-2017
Distributed under the MIT License
(See accompanying file LICENSE or visit https://github.com/cppden/med)
*/

#pragma once

#include "length.hpp"
#include "state.hpp"

namespace med {

//captures placement of IE in buffer during encoding to be updated in-place later in encoded data
//used as attribute for IE via multiple inheritance
//NOTE: requires IE to have name() defined!
struct with_snapshot {};

template <class FUNC, class IE>
constexpr void put_snapshot(FUNC& func, IE& ie)
{
	if constexpr (std::is_base_of_v<with_snapshot, IE>)
	{
		func(SNAPSHOT{snapshot_id<IE>, sl::ie_length<type_context<typename IE::ie_type>>(ie, func)});
	}
}

}
